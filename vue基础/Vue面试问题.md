# 题目

1. v-if 和 v-for 哪个优先级最高？ 如果两个同时出现，怎样优化得到更好的性能

答案： v-for的优先级高于v-if的优先级的
为了弄清楚优先级问题，我写了一个案列，让同一代码内既有v-for又有v-if，然后打印其 app.$options.render 来看的其渲染顺序，发现每次都是先有循环，再在每次循环内判断v-if，浪费了性能。即同时出现的时候v-for的优先级高于v-if。
为了解决这种问题，可以在前面先加一个template，在template这一层进行v-if的判断，然后在内部进行v-for循环

2. Vue组件中的data为什么必须是个函数而vue的根实例没有此限制？

Vue组件可能存在多个实例，如果用对象的方式定义data，则会导致他们共用一个data对象，那么状态的更改将会影响所有的实例，这是不合理的。所以采用函数的形式定义，在initData的时候会将其作为工厂函数返回全新的data对象，有效规避多实例之间状态污染的问题。
而在根实例的创建过程中则不存在该限制，因为根实例只有一个，不需要担心这种情况。

因为在创建根实例的时候使用 new 关键字只创建了一次，只是一个单例的。

3. 你知道vue中key的作用和工作原理吗？说说你对他的理解。

1 key的作用主要是为了高效的更新虚拟DOM。
原理是vue在patch的过程中通过key可以精确的判断两个节点是不是同一个，从而避免频繁的更新不同的元素，使得真个patch过程更加高效。
减少DOM的操作量，提高性能。
2 vue中在使用相同标签名元素的时候，比如表单啊之类，在进行切换的过程中vue会进最大努力去复用，而不是从新渲染，所以如果有key值的话，vue就可以区分两个元素不是同一个元素，进而就可以进行重新渲染。

4. 怎么理解veu中的diff算法

1 diff算法其实时虚拟DOM技术的必然产物，通过新旧虚拟DOM做对比，将变化的地方更新到真实的DOM上，另外，也需要diff高效的执行对比过程，从而将时间复杂度为O(n).不用diff的时候O(n^3)

2 vue 2.x 中每个组件只有一个watcher与之对于，只有引入diff才能精确的找到发生变化的地方。

3 vue中的diff执行的时刻是组件实例执行其更新函数的时候，他会对比上一次渲染的结果oldVnode和新的渲染结果newVnode,此过程称为patch。
vue 当一个数据修改的时候就会触发setter进而触发通知，然后通知就会尝试着将watcher添加到异步更新队列，在事件结束就会去清空队列，在清空队列的的过程中所有的watcher就会去执行更新函数，更新函数在执行的时候就会调用组件的渲染函数和组件的更新函数，从新渲染页面，这个就会触发diff去进行新旧DOM的对比。

4. diff整体遵循深度优先、同层比较的策略。
两个节点之间比较会根据特们是否拥有子节点或者文本节点做不同的操作；比较两组子节点是算法的重点。
先尝试将首位的节点进行比较，如果没有找到相同的节点才按照通用的方式进行遍历查找，查找结束再按情况处理剩下的节点。
借助key可以非常精确的找到相同的节点，因此整个patch过程十分高效。


